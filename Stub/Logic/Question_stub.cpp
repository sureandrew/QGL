//-- Common
#include "Common.h"
//-- Self
#include "Stub/Logic/Question_stub.h"

void Question_Stub::SetPoint(const UInt32 &point)
{
	bool modified = false;
	if (m.point != point) { m.point = point; modified = true; }
	MarkUpdateAll(pointMask, modified);
}

void Question_Stub::SetRanklist(const String &name1, const UInt32 &point1, const String &name2, const UInt32 &point2, const String &name3, const UInt32 &point3, const String &name4, const UInt32 &point4, const String &name5, const UInt32 &point5, const String &name6, const UInt32 &point6, const String &name7, const UInt32 &point7, const String &name8, const UInt32 &point8, const String &name9, const UInt32 &point9, const String &name10, const UInt32 &point10)
{
	bool modified = false;
	if (m.name1 != name1) { m.name1 = name1; modified = true; }
	if (m.point1 != point1) { m.point1 = point1; modified = true; }
	if (m.name2 != name2) { m.name2 = name2; modified = true; }
	if (m.point2 != point2) { m.point2 = point2; modified = true; }
	if (m.name3 != name3) { m.name3 = name3; modified = true; }
	if (m.point3 != point3) { m.point3 = point3; modified = true; }
	if (m.name4 != name4) { m.name4 = name4; modified = true; }
	if (m.point4 != point4) { m.point4 = point4; modified = true; }
	if (m.name5 != name5) { m.name5 = name5; modified = true; }
	if (m.point5 != point5) { m.point5 = point5; modified = true; }
	if (m.name6 != name6) { m.name6 = name6; modified = true; }
	if (m.point6 != point6) { m.point6 = point6; modified = true; }
	if (m.name7 != name7) { m.name7 = name7; modified = true; }
	if (m.point7 != point7) { m.point7 = point7; modified = true; }
	if (m.name8 != name8) { m.name8 = name8; modified = true; }
	if (m.point8 != point8) { m.point8 = point8; modified = true; }
	if (m.name9 != name9) { m.name9 = name9; modified = true; }
	if (m.point9 != point9) { m.point9 = point9; modified = true; }
	if (m.name10 != name10) { m.name10 = name10; modified = true; }
	if (m.point10 != point10) { m.point10 = point10; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName1(const String &name1)
{
	bool modified = false;
	if (m.name1 != name1) { m.name1 = name1; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint1(const UInt32 &point1)
{
	bool modified = false;
	if (m.point1 != point1) { m.point1 = point1; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName2(const String &name2)
{
	bool modified = false;
	if (m.name2 != name2) { m.name2 = name2; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint2(const UInt32 &point2)
{
	bool modified = false;
	if (m.point2 != point2) { m.point2 = point2; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName3(const String &name3)
{
	bool modified = false;
	if (m.name3 != name3) { m.name3 = name3; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint3(const UInt32 &point3)
{
	bool modified = false;
	if (m.point3 != point3) { m.point3 = point3; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName4(const String &name4)
{
	bool modified = false;
	if (m.name4 != name4) { m.name4 = name4; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint4(const UInt32 &point4)
{
	bool modified = false;
	if (m.point4 != point4) { m.point4 = point4; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName5(const String &name5)
{
	bool modified = false;
	if (m.name5 != name5) { m.name5 = name5; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint5(const UInt32 &point5)
{
	bool modified = false;
	if (m.point5 != point5) { m.point5 = point5; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName6(const String &name6)
{
	bool modified = false;
	if (m.name6 != name6) { m.name6 = name6; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint6(const UInt32 &point6)
{
	bool modified = false;
	if (m.point6 != point6) { m.point6 = point6; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName7(const String &name7)
{
	bool modified = false;
	if (m.name7 != name7) { m.name7 = name7; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint7(const UInt32 &point7)
{
	bool modified = false;
	if (m.point7 != point7) { m.point7 = point7; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName8(const String &name8)
{
	bool modified = false;
	if (m.name8 != name8) { m.name8 = name8; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint8(const UInt32 &point8)
{
	bool modified = false;
	if (m.point8 != point8) { m.point8 = point8; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName9(const String &name9)
{
	bool modified = false;
	if (m.name9 != name9) { m.name9 = name9; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint9(const UInt32 &point9)
{
	bool modified = false;
	if (m.point9 != point9) { m.point9 = point9; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetName10(const String &name10)
{
	bool modified = false;
	if (m.name10 != name10) { m.name10 = name10; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}

void Question_Stub::SetPoint10(const UInt32 &point10)
{
	bool modified = false;
	if (m.point10 != point10) { m.point10 = point10; modified = true; }
	MarkUpdateAll(ranklistMask, modified);
}



void Question_Stub::ReadAttr(CONST Buffer &buf)
{
	Parent::ReadAttr(buf);
}

void Question_Stub::WriteAttr(Buffer &buf, const RPCMask &mask) CONST
{
	Parent::WriteAttr(buf, mask);
	if (mask.IsBit(pointMask))
	{
		buf.Write<UInt32>(m.point);
	}
	if (mask.IsBit(ranklistMask))
	{
		buf.Write<String>(m.name1);
		buf.Write<UInt32>(m.point1);
		buf.Write<String>(m.name2);
		buf.Write<UInt32>(m.point2);
		buf.Write<String>(m.name3);
		buf.Write<UInt32>(m.point3);
		buf.Write<String>(m.name4);
		buf.Write<UInt32>(m.point4);
		buf.Write<String>(m.name5);
		buf.Write<UInt32>(m.point5);
		buf.Write<String>(m.name6);
		buf.Write<UInt32>(m.point6);
		buf.Write<String>(m.name7);
		buf.Write<UInt32>(m.point7);
		buf.Write<String>(m.name8);
		buf.Write<UInt32>(m.point8);
		buf.Write<String>(m.name9);
		buf.Write<UInt32>(m.point9);
		buf.Write<String>(m.name10);
		buf.Write<UInt32>(m.point10);
	}
}

RPCResult Question_Stub::SendAttr(LPCPEER pPeer, RPCContext &context, const RPCMask &mask)
{
	if (pPeer == NULL) return RPC_RESULT_FAIL;

	Buffer* pBuf = SafeCreateObject(Buffer);
	Reuben::Network::RPCHeader header(RPC_Question_UP_STATE);
	pBuf->Write<Reuben::Network::RPCHeader>(header);
	pBuf->Write<RPCContext>(context);
	pBuf->Write<RPCNetID>(m_netId);
	WriteAttr(*pBuf, mask);

	return RPCSend(pPeer, pBuf);
}

#pragma optimize("", off)
RPCResult Question_Stub::Process(const RPCID rpcId, LPCPEER pPeer, RPCContext &context, Buffer* pBuf)
{
	RPCResult _result = RPC_NOT_ACCESS;
	switch(rpcId)
	{
	case 0:
		break;
	case RPC_Question_REQ_STATE:
		{
			RPCMask mask;
			pBuf->Read<RPCMask>(mask);
			_result = SendAttr(pPeer, context, mask);
		}
		break;
	case RPC_Question_Anwser:
		{
			UInt32 question_id;
			pBuf->Read<UInt32>(question_id);
			UInt16 anwserIndex;
			pBuf->Read<UInt16>(anwserIndex);
			_result = Anwser(pPeer, context, question_id, anwserIndex);
		}
		break;
	default:
		_result = Parent::Process(rpcId, pPeer, context, pBuf);
	}
	return _result;
}
#pragma optimize("", on)

RPCResult Question_Stub::CB_NextQuestion(LPCPEER pPeer, RPCContext &context, const UInt32 &count, const UInt32 &question_id, const String &description, const String &option1, const String &option2, const String &option3, const String &option4)
{
	if (pPeer == NULL || pPeer->IsAlive() == BOOLEAN_FALSE) return RPC_RESULT_FAIL;
	Buffer* pBuf = SafeCreateObject(Buffer);
	Reuben::Network::RPCHeader header(RPC_Question_CB_NextQuestion);
	pBuf->Write<Reuben::Network::RPCHeader>(header);
	if (context.bCallback && context.pcdId.subId != 0)
		pBuf->Write<RPCContext>(GetCbContext(context));
	else
		pBuf->Write<RPCContext>(context);
	pBuf->Write<RPCNetID>(m_netId);
	pBuf->Write<UInt32>(count);
	pBuf->Write<UInt32>(question_id);
	pBuf->Write<String>(description);
	pBuf->Write<String>(option1);
	pBuf->Write<String>(option2);
	pBuf->Write<String>(option3);
	pBuf->Write<String>(option4);
	return RPCSend<1688412626>(pPeer, pBuf);
}

RPCResult Question_Stub::CB_AnswerResult(LPCPEER pPeer, RPCContext &context, const Boolean &bRight)
{
	if (pPeer == NULL || pPeer->IsAlive() == BOOLEAN_FALSE) return RPC_RESULT_FAIL;
	Buffer* pBuf = SafeCreateObject(Buffer);
	Reuben::Network::RPCHeader header(RPC_Question_CB_AnswerResult);
	pBuf->Write<Reuben::Network::RPCHeader>(header);
	if (context.bCallback && context.pcdId.subId != 0)
		pBuf->Write<RPCContext>(GetCbContext(context));
	else
		pBuf->Write<RPCContext>(context);
	pBuf->Write<RPCNetID>(m_netId);
	pBuf->Write<Boolean>(bRight);
	return RPCSend<529400276>(pPeer, pBuf);
}

RPCResult Question_Stub::CB_StartCountDown(LPCPEER pPeer, RPCContext &context, const UInt32 &count)
{
	if (pPeer == NULL || pPeer->IsAlive() == BOOLEAN_FALSE) return RPC_RESULT_FAIL;
	Buffer* pBuf = SafeCreateObject(Buffer);
	Reuben::Network::RPCHeader header(RPC_Question_CB_StartCountDown);
	pBuf->Write<Reuben::Network::RPCHeader>(header);
	if (context.bCallback && context.pcdId.subId != 0)
		pBuf->Write<RPCContext>(GetCbContext(context));
	else
		pBuf->Write<RPCContext>(context);
	pBuf->Write<RPCNetID>(m_netId);
	pBuf->Write<UInt32>(count);
	return RPCSend<922421266>(pPeer, pBuf);
}

